#textdomain wesnoth-A_Song_of_Fire
[scenario]
    id=14_The_Sky_Dragon_Descends
    name= _ "The Sky Dragon Descends"
    next_scenario=15_Farewell
    map_data="{~add-ons/A_Song_of_Fire/maps/14_The_Sky_Dragon_Descends.map}"
    victory_when_enemies_defeated=no
    turns=-1
    {STORMY_SKY}

    {SCENARIO_MUSIC battlecry.ogg}
    {EXTRA_SCENARIO_MUSIC heroes_rite.ogg}
    {EXTRA_SCENARIO_MUSIC siege_of_laurelmor.ogg}
    {EXTRA_SCENARIO_MUSIC casualties_of_war.ogg}
    {EXTRA_SCENARIO_MUSIC battle-epic.ogg}
    {EXTRA_SCENARIO_MUSIC the_city_falls.ogg}

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Resist the dragons' attack for 3 days (18 turns)"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Myra"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Alenya"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Jevyan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Varthan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Maat"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dvalin"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Ravyan"
                condition=lose
            [/objective]

            [gold_carryover]
                carryover_percentage=0
            [/gold_carryover]
        [/objectives]
    [/event]

    {THE_SKY_DRAGON_DESCENDS_STORY}

    {STARTING_VILLAGES 1 3}
    {STARTING_VILLAGES 2 5}
    {STARTING_VILLAGES 3 3}
    {STARTING_VILLAGES 4 3}
    {STARTING_VILLAGES 5 5}
    {STARTING_VILLAGES 6 5}
    {STARTING_VILLAGES 7 5}
    {STARTING_VILLAGES 8 5}
    {STARTING_VILLAGES 9 5}

    [label]
        x,y=4,66
        text=_"Sky Mountains"
    [/label]

    [side]
        {MYRA}
        recruit=Wisp,Brazier Imp,Sylph,Tidal,Vine Beast,Kobold,Razorbird
        {GOLD 600 580 540}
        team_name=windsong
        user_team_name=_"Windsong"
        {INCOME 70 60 40}
        {FLAG_VARIANT long}
    [/side]

    [side]
        no_leader=yes
        side=2
        canrecruit=yes
        controller=human
        recruit=Aragwaith Lancer,Aragwaith Strongbow,Aragwaith Guard,Aragwaith Pikeman,Aragwaith Flagbearer,Aragwaith Longswordsman,Aragwaith Silver Shield,Aragwaith Swordsmaster,Aragwaith Slayer,Aragwaith Greatbow
        team_name=windsong
        user_team_name=_"Kingdom of Garet-Desh"
        persistent=yes
        {GOLD 800 750 700}
        {INCOME 40 30 20}
        [unit]
            {DASHIEN}
            x=38
            y=35
        [/unit]
        [unit]
            type=Aragwaith Ancient Banner
            id=Aracyn
            name= _ "General Aracyn"
            x=38
            y=38
            {IS_LOYAL}
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
    [/side]

    [side]
        no_leader=yes
        side=3
        canrecruit=yes
        controller=human
        recruit=Dwarvish Steelclad,Dwarvish Thunderguard,Dwarvish Pathfinder,Dwarvish Lord,Dwarvish Dragonguard,Dwarvish Explorer
        team_name=windsong
        user_team_name=_"Aigathol Dwarves"
        persistent=yes
        {FLAG_VARIANT knalgan}
        {GOLD 840 800 750}
        {INCOME 70 60 40}
    [/side]

    [side]
        {THELIAN}
        side=4
        recruit=Elvish Hero,Elvish Captain,Elvish Marksman,Elvish Ranger,Elvish Druid,Elvish Sorceress,Elvish Enchantress,Elvish Sharpshooter,Elvish Champion,Elvish Shyde
        team_name=windsong
        user_team_name=_"Varanyan Elves"
        {GOLD 890 860 830}
        {INCOME 70 60 40}
        {FLAG_VARIANT wood-elvish}
        [ai]
            {NO_SCOUTS}
            recruitment_pattern=fighter,fighter,mixed fighter, mixed fighter,archer,archer,healer
            grouping=defensive
            passive_leader=yes
        [/ai]
        [unit]
            {GILGAWIEN}
            ai_special=guardian
            x=39
            y=43
        [/unit]
    [/side]

    [side]
        type=Great Troll
        id=Groth
        name= _"Groth"
        side=5
        canrecruit=yes
        recruit=Troll,Troll Rocklobber,Troll Shaman,Troll Hero,Troll Warrior,Troll Boulderlobber
        team_name=windsong
        user_team_name=_"Trolls"
        {GOLD 890 860 830}
        {INCOME 85 80 70}
        {FLAG_VARIANT6 ragged}
        [ai]
            {NO_SCOUTS}
            recruitment_pattern=fighter,fighter,fighter,mixed fighter,mixed fighter,archer,archer
            grouping=defensive
            passive_leader=yes
        [/ai]
    [/side]

    [side]
        type=Fire Dragon
        id=Niddhon
        name= _ "Niddhon"
        side=6
        canrecruit=yes
        recruit=Drake Warrior,Drake Thrasher,Drake Arbiter,Drake Flare,Fire Drake,Inferno Drake,Drake Enforcer,Drake Blademaster,Saurian Soothsayer
        team_name=dragons
        user_team_name=_"Dragon Army"
        {GOLD 1150 1200 1250}
        {FLAG_VARIANT loyalist}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value 0}
            passive_leader=yes
            time_of_day=stormy_dawn,stormy_dusk
            aggression=0.95
            caution=0.05
        [/ai]
        {INCOME 100 100 110}
    [/side]

    [side]
        type=Fire Dragon
        id=Shakkha
        name= _ "Shakkha"
        side=7
        canrecruit=yes
        recruit=Drake Warrior,Drake Thrasher,Drake Arbiter,Drake Flare,Fire Drake,Inferno Drake,Drake Warden,Drake Blademaster,Saurian Oracle
        team_name=dragons
        user_team_name=_"Dragon Army"
        {GOLD 1200 1250 1300}
        {FLAG_VARIANT loyalist}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value 0}
            passive_leader=yes
            time_of_day=stormy_dawn,stormy_dusk
            aggression=0.75
            caution=0.25
        [/ai]
        {INCOME 110 110 120}
    [/side]

    [side]
        type=Fire Dragon
        id=Agadhor
        name= _ "Agadhor"
        side=8
        canrecruit=yes
        recruit=Drake Warrior,Drake Thrasher,Drake Arbiter,Drake Flare,Fire Drake,Inferno Drake,Drake Warden,Drake Blademaster
        team_name=dragons
        user_team_name=_"Dragon Army"
        {GOLD 1150 1200 1250}
        {FLAG_VARIANT loyalist}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value 0}
            passive_leader=yes
            time_of_day=stormy_dawn,stormy_dusk
            aggression=0.75
            caution=0.25
        [/ai]
        {INCOME 100 100 110}
    [/side]

    [side]
        {SHEKHAR}
        side=9
        canrecruit=yes
        recruit=Fire Dragon,Drake Warrior,Drake Thrasher,Drake Arbiter,Drake Flare,Fire Drake,Inferno Drake,Drake Warden,Drake Blademaster,Saurian Flanker,Saurian Oracle,Saurian Soothsayer,Saurian Ambusher
        team_name=dragons
        user_team_name=_"Dragon Army"
        {GOLD 1250 1300 1400}
        {FLAG_VARIANT loyalist}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value 0}
            passive_leader=yes
            time_of_day=stormy_dawn,stormy_dusk
            aggression=0.95
            caution=0.05
        [/ai]
        {INCOME 125 130 140}
        [unit]
            {SHEKKAHAN}
            ai_special=guardian
            {IS_LOYAL}
            x=7
            y=49
        [/unit]
        [unit]
            {KHRAKRAHS}
            ai_special=guardian
            {IS_LOYAL}
            x=11
            y=50
        [/unit]
    [/side]

    {LIMIT_RECRUITS 9 (Fire Dragon) 3}

    [side]
        side=10
        team_name=svarballi
        user_team_name=_"???"
        no_leader=yes
        gold=0
        income=0
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value 0}
            aggression=10.00
            caution=0.00
            [avoid]
                x=5-12,1-10,57-66,45-56
                y=48-52,20-27,60-66,5-12
            [/avoid]
            [goal]
                name=target
                [criteria]
                    id=Maat
                [/criteria]
                value=100
            [/goal]
        [/ai]
    [/side]

    # The enemy is able to recruit Fire Dragons already, we don't need to make it even harder for the player

    {LIMIT_RECRUITS 6 (Inferno Drake) 6}
    {LIMIT_RECRUITS 7 (Inferno Drake) 6}
    {LIMIT_RECRUITS 8 (Drake Blademaster) 5}
    {LIMIT_RECRUITS 9 (Drake Warden) 6}

    [event]
        name=prestart
        [recall]
            id=Jevyan
            x=39
            y=31
        [/recall]
        [recall]
            id=Alenya
            x=39
            y=30
        [/recall]
        [recall]
            id=Ravyan
            x=40
            y=29
        [/recall]

        [allow_recruit]
            side=1
            type=Savant,Heretic,Pathfinder,Reaver,Emissary,Envoy,Skyrunner,Lorekeeper,Yansa Tear
        [/allow_recruit]

        [unstore_unit]
            variable=maat2_store
            x=41
            y=31
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE maat2_store}

        {LOYAL_UNIT 9 (Fire Dragon) 11 54} {GUARDIAN}
        {LOYAL_UNIT 9 (Fire Dragon) 6 54} {GUARDIAN}

        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 38 27}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 36 28}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 34 29}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 32 30}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 30 31}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 29 33}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 28 34}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 28 39}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 29 41}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 30 42}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 32 43}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 34 44}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 36 45}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 38 46}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 42 46}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 44 45}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 46 44}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 48 43}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 50 42}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 51 41}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 52 39}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 52 34}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 51 33}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 50 31}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 48 30}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 46 29}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 44 28}
        {LOYAL_UNIT 2 (Aragwaith Shield Guard) 42 27}

        [recall]
            id=Varthan
            x,y=40,36
        [/recall]

        {UNMAKE_HERO id=Varthan}
        {MODIFY_UNIT id=Varthan side 2}
        {MODIFY_UNIT id=Varthan canrecruit yes}
        {MODIFY_UNIT id=Varthan name "King Varthan"}

        [recall]
            id=Dvalin
            x,y=48,36
        [/recall]

        {UNMAKE_HERO id=Dvalin}
        {MODIFY_UNIT id=Dvalin side 3}
        {MODIFY_UNIT id=Dvalin canrecruit yes}
    [/event]

    # Now that Varthan is leading his men alone, Myra can no longer recruit Aragwaithi, but may still recall those who have been
    # recruited in previous scenarios

    [event]
        name=start

        [disallow_recruit]
            side=1
            type=Aragwaith Scout,Aragwaith Spearman,Aragwaith Swordsman,Aragwaith Archer,Dwarvish Steelclad,Dwarvish Pathfinder,Dwarvish Thunderguard
        [/disallow_recruit]

        [store_unit]
            [filter]
                side=1
                type=Dwarvish Fighter,Dwarvish Steelclad,Dwarvish Lord,Dwarvish Scout,Dwarvish Pathfinder,Dwarvish Explorer,Dwarvish Thunderguard,Dwarvish Dragonguard
                [not]
                    id=Dvalin
                [/not]
            [/filter]

            kill=yes
            variable=dwarvish_veterans
        [/store_unit]

        [foreach]
            array = dwarvish_veterans
            variable = dwarf_unit
            [do]
                {VARIABLE dwarf_unit.side 3}
                [unstore_unit]
                    variable=dwarf_unit
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE dwarvish_veterans}

        [message]
            speaker="Shek'kahan"
            message= _ "As I told you, father: the elves, the trolls and the dwarves have all gathered with the humans."
        [/message]
        [message]
            speaker=Khrakrahs
            message= _ "So, if we kill them all here we won't have to search for scattered survivors later."
        [/message]
        [message]
            speaker="Shek'har"
            message= _ "You are aware of the fate that is about to befall you, aren't you, puny creatures?"
        [/message]
        [message]
            speaker=Maat
            message= _ "We make our own fate, dragon. The time for words is over; now, we fight!"
        [/message]
        [message]
            speaker="Shek'har"
            message= _ "So be it... Children of Morogor, warriors of the Sky Dragon: CHARGE!"
        [/message]
        [message]
            speaker=Maat
            message= _ "It is time, my friends! Fight for our future!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Aracyn
        [/filter]
        [message]
            speaker=Aracyn
            image=portraits/aracyn.webp
            message= _ "I now go to Lord Abhai's side... Defend our people, my sons..."
        [/message]
        [message]
            speaker=Jevyan
            message= _ "FATHER!"
        [/message]
        [message]
            speaker=Myra
            message=_ "No, Jevyan! There are too many enemies on that side, if you go alone you'll die!"
        [/message]
        [message]
            speaker=Ravyan
            message= _ "She's right, cousin... Don't forfeit your life, but vent your anger on these drakes! Come, I shall fight alongside you!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Groth
        [/filter]
        [message]
            speaker=Groth
            message=_ "I die a warrior's death... Fight on without me, my people!"
        [/message]
        [message]
            speaker=Dvalin
            message=_ "(furious) Dwarves! Let's give Chief Groth a retinue of drakes to serve him in the World of the Dead!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Thelian
        [/filter]
        [message]
            speaker=Thelian
            message=_ "Alas, never shall I see the green woods again..."
        [/message]
        [if]
            [have_unit]
                id=GilGawien
            [/have_unit]
            [then]
                [message]
                    speaker=GilGawien
                    message=_ "Lord Thelian! I shall not let your death be in vain... Elves, follow me! We will show the dragons what happens to the fools who make an enemy out of an elf!"
                [/message]

                {MODIFY_UNIT id=GilGawien canrecruit yes}
                {MOVE_UNIT id=GilGawien 40 43}
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=GilGawien
        [/filter]
        [if]
            [have_unit]
                id=Thelian
            [/have_unit]
            [then]
                [message]
                    speaker=GilGawien
                    message=_ "My love...!"
                [/message]
                [message]
                    speaker=Thelian
                    message=_ "Gil-Gawien, NO!"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=GilGawien
                    message=_ "Lord Thelian, I now go join you in the other world..."
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Dashien
        [/filter]
        [message]
            speaker=Dashien
            message=_ "Thus falls the last King of Valon... At long last, I shall be reunited with my wife and daughters..."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1,2,3,4,5
            [filter_location]
                x,y=51,8
                radius=5
            [/filter_location]
        [/filter]

        [modify_side]
            side=6
            {GOLD 600 650 700}
        [/modify_side]

        [message]
            speaker=Niddhon
            message=_ "Unbelievable, the vermin are making advance! But not for long... Call in the reserves!"
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1,2,3,4,5
            [filter_location]
                x,y=5,23
                radius=6
            [/filter_location]
        [/filter]

        [modify_side]
            side=7
            {GOLD 600 650 700}
        [/modify_side]

        [message]
            speaker=Shakkha
            message=_ "How shameful that I'm forced to send even my reserve troops to battle!"
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1,2,3,4,5
            [filter_location]
                x,y=62,63
                radius=5
            [/filter_location]
        [/filter]

        [modify_side]
            side=8
            {GOLD 600 650 700}
        [/modify_side]

        [message]
            speaker=Agadhor
            message=_ "Accursed apes, I will burn you all to a cinder! Send in the reserves!"
        [/message]
    [/event]

    [event]
        name=last breath
        first_time_only=no
        [filter]
            id="Shek'kahan"
            [or]
                id=Khrakrahs
            [/or]
        [/filter]

        [modify_side]
            side=9
            {GOLD 600 650 700}
        [/modify_side]

        [message]
            speaker="Shek'har"
            message=_ "Son, you have been wounded; leave this battlefield at once! As for you, pesky apes, you will regret what you have just done..."
        [/message]
    [/event]

    [event]
        name=last_breath
        first_time_only=no
        [filter]
            side=6,7,8,9
            canrecruit=yes
        [/filter]
        [if]
            [have_unit]
                side=6,7,8,9
                canrecruit=yes
            [/have_unit]
            [else]
                [fire_event]
                    name=sky_dragon_1
                [/fire_event]
                [fire_event]
                    name=sky_dragon_2
                [/fire_event]
            [/else]
        [/if]
    [/event]

    [event]
        name=turn 19
        [fire_event]
            name=sky_dragon_1
        [/fire_event]
    [/event]


    [event]
        name=sky_dragon_1
        [message]
            speaker=Varthan
            message= _ "We have been giving these overgrown lizards hell for days already, and we still stand! SEE THAT, SKY DRAGON? YOUR WARRIORS ARE NO MATCH FOR OUR MIGHT!"
        [/message]
        [delay]
            time=600
        [/delay]

        # A little suspense...

        {REPLACE_SCENARIO_MUSIC frantic.ogg}
        {THUNDER_LIGHTNING}

        [delay]
            time=1000
        [/delay]

        [message]
            speaker=Maat
            message= _ "It's him... Svarballi is coming!"
        [/message]
        [message]
            speaker="Shek'har"
            message= _ "No... Destroy them at once, you incompetent fools, before Lord Svarballi arrives!"
        [/message]
    [/event]

    [event]
        name=turn 20
        [fire_event]
            name=sky_dragon_2
        [/fire_event]
    [/event]

    [event]
        name=sky_dragon_2

        # And now...

        {REPEAT 2 ({THUNDER_LIGHTNING})}

        [delay]
            time=800
        [/delay]

        [unit]
            type=Sky Dragon
            side=10
            x=5
            y=65
            id=Svarballi
            name=_ "Svarballi"
        [/unit]

        [scroll_to_unit]
            id=Svarballi
        [/scroll_to_unit]

        [delay]
            time=800
        [/delay]

        [message]
            speaker=Myra
            message= _ "The-"
        [/message]
        [message]
            speaker=Alenya
            message= _ "The legendary...!"
        [/message]
        [message]
            speaker=Varthan
            message= _ "...Sky Dragon!"
        [/message]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "You fools... You had your foes completely at your mercy, heavily outnumbered, and yet here I am, forced to settle this matter myself..."
        [/message]
        [message]
            speaker="Shek'har"
            message= _ "Forgive me, Lord Svarballi, I..."
        [/message]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "But that was to be expected; mere fire dragons like you would have never defeated this High Ascendant, whom some seem to call the 'Chosen of Gods'..."
        [/message]
        [message]
            speaker=Maat
            message= _ "Goddess I am not, Sky Dragon, but I can still do everything in my power to stop you from destroying this world."
        [/message]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "Which world? This world of endless violence? This world where living beings feed on their fellow living beings to survive? Pitiful creature! (roaring to the skies) Was that what you died for, Nitiballi? So that these miserable wretches might suffer with endless wars and strife? (turning back to Maat) All I want is to put an end to the misery of this so-called 'Miracle of Life', but you insist on seeing it persist; <i>you</i> are the real villain here, Maat of Hiera'Shirsha!"
        [/message]
        [message]
            speaker=Maat
            message= _ "I cannot deny that wherever there is life, there is conflict and strife... But you cannot deny that, wherever there is life, there is also love, friendship, joy, dreams... It is your fault that you could not see that life is not only peace and harmony, but also war and chaos; and neither of them changes the fact that many beings of this planet do manage to find happiness..."
        [/message]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "Nonsense. Peace, love and joy are mere illusions created by the living to disguise the truth about life: that it is <i>made</i> of chaos and strife, and will always be."
        [/message]
        [message]
            speaker=Maat
            message= _ "No, it is not, Svarballi, can't you see that?"
        [/message]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "I can only see the undisguised truth."
        [/message]
        [message]
            speaker=Maat
            message= _ "No, you have only twisted it because it did not fit your belief in a perfectly calm world-"
        [/message]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "(roaring) There is no use in arguing anymore! I shall crush you and your beloved little pests, and then we'll see who is right!"
        [/message]

        [objectives]
            side=0
            [objective]
                description= _ "Fight Svarballi"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Myra"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Alenya"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Jevyan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Varthan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Maat"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dvalin"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Ravyan"
                condition=lose
            [/objective]

            [gold_carryover]
                carryover_percentage=0
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=die
        [filter]
            side=6,7,8,9
        [/filter]
        [filter_second]
            id=Svarballi
        [/filter_second]
        [message]
            speaker=Maat
            message= _ "Now you see that your precious lord was never interested in helping the dragons, Shek'har?"
        [/message]
        [message]
            speaker="Shek'har"
            message= _ "No, that... that can't be... What have I..."
        [/message]
        [message]
            speaker="Shek'kahan"
            message= _ "(whispering) Father, maybe we should, you know, help the Ascendant; at least she will not kill us..."
        [/message]
        [message]
            speaker="Shek'har"
            message= _ "I will never side with inferior races! My sons, gather your drakes and leave this accursed battlefield!"
        [/message]
        [kill]
            side=9
        [/kill]
        [message]
            speaker=Agadhor
            message= _ "The cowards are fleeing! Do not let yourselves be deceived, my warriors, for Lord Svarballi <i>will</i> usher us into a new Dragon Age!"
        [/message]

        [modify_side]
            side=6
            team_name=svarballi
        [/modify_side]
        [modify_side]
            side=7
            team_name=svarballi
        [/modify_side]
        [modify_side]
            side=8
            team_name=svarballi
        [/modify_side]
    [/event]

    [event]
        name=turn 22
        [message]
            speaker=Myra
            message= _ "Mother, now it's time for us to face Svarballi!"
        [/message]
        [message]
            speaker=Maat
            message= _ "(sighing) For me, not for you..."
        [/message]
        [message]
            speaker=Myra
            message= _ "What do you-"
        [/message]
        [message]
            speaker=Maat
            message= _ "Cipher of Sleep."
        [/message]

        [sound]
            name=magic-missile-2.ogg
        [/sound]

        [sound]
            name=human_female_hit_1.ogg
        [/sound]

        [store_unit]
            [filter]
                id=Myra
            [/filter]
            variable=myra2_store
            kill=yes
        [/store_unit]

        [message]
            speaker=Alenya
            message= _ "Lady Maat! What have you done?!"
        [/message]
        [message]
            speaker=Maat
            message= _ "Alenya, please tell her I am sorry for deceiving her once again, but... I just cannot allow her to die here; she would kill herself trying to vanquish Svarballi, just like Nitiballi did. I've seen someone I love sacrifice herself right before my eyes, once... I will not have it happen again, not if I can stop it myself."
        [/message]
        [message]
            speaker=Jevyan
            message= _ "But you were supposed to fight together, like the Water and Fire Dragons did, right?"
        [/message]
        [message]
            speaker=Maat
            message= _ "That's what <i>they</i> did, not what <i>we</i> have to do. Now, please take her and the other Aragwaithi away; King Varthan, I have no authority over you, but you should go as well; your people need you."
        [/message]
        [message]
            speaker=Varthan
            message= _ "You... I shall... do as you say, for I acknowledge my people need me."
        [/message]
        [message]
            speaker=Alenya
            message= _ "Dvalin, you must help escorting the refugees to a safer place! Come with us!"
        [/message]
        [message]
            speaker=Dvalin
            message= _ "And flee from the battlefield? Never!"
        [/message]
        [message]
            speaker=Maat
            message= _ "You will not be fleeing, worthy Dvalin; you would be saving the defenceless refugees. Other than Varthan, you will be the only leader left, so you will be needed."
        [/message]
        [message]
            speaker=Dvalin
            message= _ "Well, thinking this way... Then we shall go east! Come with us, women and children of dwarf-kind, elf-kind, humankind and troll-kind! We shall lead you to safety!"
        [/message]
        [if]
            [have_unit]
                id=Aracyn
            [/have_unit]
            [then]
                [message]
                    speaker=Aracyn
                    image=portraits/aracyn.webp
                    message= _ "Go with him, my sons. I shall stay and help Lady Maat. And no, don't try to convince me otherwise; as Lord Abhai told me before leaving for Valon, the old must make sure that there is a future for the young."
                [/message]
                [message]
                    speaker=Jevyan
                    message= _ "Father..."
                [/message]
                [message]
                    speaker=Aracyn
                    image=portraits/aracyn.webp
                    message= _ "And son... I know I may have been too strict, maybe even harsh, but... Know that I am, and always have been, proud of the man you've become. Now go, and lead the remaining Aragwaithi to safety! And you, my warriors, it was an honour to fight alongside you! Let's bring some drake companions to follow us to the world of the dead!"
                [/message]

                {UNMAKE_HERO id=Acacyn}
                {MODIFY_UNIT id=Aracyn canrecruit yes}
            [/then]
        [/if]
        [if]
            [have_unit]
                id=Thelian
            [/have_unit]
            [then]
                [message]
                    speaker=Thelian
                    message= _ "The younger ones may follow Prince Varthan; as for the veterans, we shall give these dragons hell before we go!"
                [/message]
                [if]
                    [have_unit]
                        id=GilGawien
                    [/have_unit]
                    [then]
                        [message]
                            speaker=GilGawien
                            message= _ "To the ruin and the end of the world and back to the earth whence we came - together, my love!"
                        [/message]
                        [message]
                            speaker=Thelian
                            message= _ "Death itself frightens me not with you by my side, Gil-Gawien..."
                        [/message]
                    [/then]
                [/if]
            [/then]
            [else]
                [message]
                    speaker=GilGawien
                    message= _ "The younger ones may follow Prince Varthan; as for the veterans, we shall send a few more drakes for Lord Thelian in the World of the Dead!"
                [/message]
            [/else]
        [/if]
        [if]
            [have_unit]
                id=Groth
            [/have_unit]
            [then]
                [message]
                    speaker=Groth
                    message= _ "The women and the children must go and find a new home for our people; but I shall stay and die a warrior's death!"
                [/message]

                [role]
                    type=Troll,Troll Rocklobber,Troll Shaman,Troll Hero,Troll Warrior,Troll Boulderlobber
                    role=Supporter
                [/role]

                [message]
                    role=Supporter
                    message= _ "And we shall be with you, Chief!"
                [/message]
            [/then]
        [/if]

        {MODIFY_UNIT side=2 side 1}
        {MODIFY_UNIT side=3 side 1}

        {PUT_TO_RECALL_LIST (
            side=1
            [not]
                id=Maat

                [or]
                    id=Alenya
                [/or]
                [or]
                    id=Jevyan
                [/or]
                [or]
                    id=Myra
                [/or]
                [or]
                    id=Ravyan
                [/or]
                [or]
                    id=Varthan
                [/or]
                [or]
                    id=Aracyn
                [/or]
                [or]
                    id=Dashien
                [/or]
                [or]
                    type=Aragwaith Shield Guard
                [/or]
                [or]
                    id=Dvalin
                [/or]
            [/not]
        )}

        {MOVE_UNIT id=Dvalin 70 36}
        [store_unit]
            [filter]
                id=Dvalin
            [/filter]
            variable=dvalin
            kill=yes
        [/store_unit]

        {MOVE_UNIT id=Alenya 70 37}
        [store_unit]
            [filter]
                id=Alenya
            [/filter]
            variable=alenya
            kill=yes
        [/store_unit]

        {MOVE_UNIT id=Jevyan 70 39}
        [store_unit]
            [filter]
                id=Jevyan
            [/filter]
            variable=jevyan
            kill=yes
        [/store_unit]

        {MOVE_UNIT id=Ravyan 70 40}
        [store_unit]
            [filter]
                id=Ravyan
            [/filter]
            variable=ravyan
            kill=yes
        [/store_unit]

        {MOVE_UNIT id=Varthan 70 38}
        [store_unit]
            [filter]
                id=Varthan
            [/filter]
            variable=varthan
            kill=yes
        [/store_unit]

        {UNMAKE_HERO id=Maat}
        {MODIFY_UNIT id=Maat canrecruit yes}

        [disallow_recruit]
            side=1
            type=Wisp,Brazier Imp,Sylph,Tidal,Vine Beast,Kobold,Razorbird,Savant,Heretic,Pathfinder,Reaver,Emissary,Envoy,Skyrunner,Lorekeeper
        [/disallow_recruit]

        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "Futile efforts; I shall obliterate you from existence and then chase them down."
        [/message]
        [message]
            speaker=Maat
            message= _ "I will not have that happen, Svarballi..."
        [/message]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "What... What are you doing...?"
        [/message]
        [message]
            speaker=Maat
            message= _ "*Hathy, Deni, forgive me for what I'm about to do... But just like you, I cannot stand to see someone I love risk her life - even if that means giving my own...*"
        [/message]
        [message]
            speaker=narrator
            message= _ "Svarballi watched her in silence, as did the other dragons, drakes, humans, elves, saurians and trolls; and soon an unbelievable silence befell the bloody battlefield as everyone watched the High Ascendant."
        [/message]

        {REPLACE_SCENARIO_MUSIC legends_of_the_north.ogg}

        [message]
            speaker=narrator
            message= _ "And then it happened: hundreds, thousands of greyish-blue streams of light formed out of thin air all around Maat, wrapping her in a bright web of light; then, for a split moment it was as if reality itself had been shattered - for in that split moment everyone on that battlefield saw glimpses of a million realms, each stranger than the other. As the light receded and the visions were replaced by the landscape where they stood, everyone could see Maat again, but she was not the same: her body emanated a cold aura, her eyes shone like blue stars, and all contenders, even those far from the Ascendant, could sense the power she exuded."
        [/message]

        {THUNDER_LIGHTNING}

        [object]
            id=irdya_avatar
            duration=forever
            silent=yes
            [filter]
                id=Maat
            [/filter]
            [effect]
                apply_to=type
                name=High Ascendant Irdya Avatar
            [/effect]
        [/object]

        [heal_unit]
            [filter]
                id=Maat
            [/filter]
            amount=full
            moves=full
            restore_attacks=yes
            restore_statuses=yes
        [/heal_unit]

        {MODIFY_UNIT id=Maat profile "portraits/maat-avatar.webp"}

        [delay]
            time=400
        [/delay]

        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "So this is it: the fabled High Ascendant, who controls and harnesses the power of the Worldsweave itself... It still will not help you, though, for you are no goddess - and unlike Agniballi and Nitiballi, you're on your own!"
        [/message]
        [message]
            speaker=Maat
            message= _ "I'm not on my own, Svarballi, not with the Raw by my side... I control the Worldsweave that ties all dimensions - so step forward, Sky Dragon, and measure your strength against that of existence itself!"
        [/message]

        [gold]
            side=1
            amount=1000
        [/gold]

        [objectives]
            [objective]
                description= _ "Maat must kill Svarballi"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Maat"
                condition=lose
            [/objective]

            [gold_carryover]
                carryover_percentage=0
            [/gold_carryover]
        [/objectives]
    [/event]

    # Because it would be just too silly to kill a dragon god with a level 1 Sky Crystal, right?

    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Svarballi
        [/filter]
        [filter_second]
            [not]
                id=Maat
            [/not]
        [/filter_second]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message=_ "Pathetic creatures! How can you possibly believe that puny vermin like you are capable of defeating me, the High Dragon of the Sky?!"
        [/message]

        {ADVANCE_UNIT (id=Svarballi) ()}

        [message]
            speaker=Maat
            message= _"Stand aside, warriors! Only I can defeat him!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Svarballi
        [/filter]
        [filter_second]
            id=Maat
        [/filter_second]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _ "What is happening...?! How can a simple human wield such power...?!"
        [/message]
        [message]
            speaker=Shakkha
            message= _ "Our king is in danger! Niddhon, Agadhor, we must go to his aid!"
        [/message]

        [store_locations]
            [filter]
                id=Maat
            [/filter]
            radius=3
            variable=possible_maat_locations
        [/store_locations]

        {MOVE_UNIT id=Agadhor $possible_maat_locations.x $possible_maat_locations.y}
        {MOVE_UNIT id=Niddhon $possible_maat_locations.x $possible_maat_locations.y}
        {MOVE_UNIT id=Shakkha $possible_maat_locations.x $possible_maat_locations.y}

        {CLEAR_VARIABLE possible_maat_locations}

        [message]
            speaker=Maat
            message=_ "It is futile to help him, lesser dragons, you will only suffer the same fate as Svarballi!"
        [/message]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _"Stop your nonsense! I am immortal!"
        [/message]
        [message]
            speaker=Maat
            message= _"I never meant to kill you, Svarballi..."
        [/message]

        {THUNDER_LIGHTNING}

        [delay]
            time=200
        [/delay]
        [sound]
            name=magic-faeriefire.ogg
        [/sound]

        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _"You... You are channelling too much power, you fool! At this rate you will be obliterated!"
        [/message]
        [message]
            speaker=Maat
            message= _"I always knew that - but I <i>shall</i> see you beaten before I go!"
        [/message]
        [message]
            speaker=Svarballi
            image=portraits/svarballi.webp
            message= _"YOU... DARN... VERMIN!!!"
        [/message]
        [message]
            speaker=Maat
            message= _"THIS IS YOUR END, SVARBALLI!!!"
        [/message]

        {THUNDER_LIGHTNING}

        [delay]
            time=200
        [/delay]

        [sound]
            name=magic-faeriefire.ogg
        [/sound]

        {REPEAT 5 ({THUNDER_LIGHTNING})}

        [sound]
            name=gun-energy-huge-fire.ogg
        [/sound]

        [kill]
            [not]
                x,y=recall,recall
            [/not]
            [not]
                x,y=recall,recall
            [/not]
            animate=no
        [/kill]

        # This is just a way to avoid the old bug in Farewell - Part I, yes, I know it's ugly, but if you know a better way to solve this, you're
        # welcome to tell me u.u

        [unstore_unit]
            variable=myra2_store
            x=2
            y=2
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE myra2_store}

        [modify_side]
            [filter]
                side=1
            [/filter]
            fog=yes
        [/modify_side]

        [endlevel]
            result=victory
            bonus=no
            carryover_report=no
            linger_mode=no
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Myra
        [/filter]
        [message]
            speaker=Myra
            message= _ "How can I fall without avenging Veela...?!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Maat
        [/filter]
        [message]
            speaker=Maat
            message= _ "I... mustn't... fall..."
        [/message]
        [message]
            speaker=Myra
            message= _ "MOTHER, NO!!!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Varthan
        [/filter]
        [message]
            speaker=Varthan
            message= _ "I have fallen; now, who will succeed my father as the King of Garet-Desh...?"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Alenya
        [/filter]
        [message]
            speaker=Alenya
            message= _ "Alas, I shall never see my dear Lintanir again..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Jevyan
        [/filter]
        [message]
            speaker=Jevyan
            message= _ "No... father, help-"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Ravyan
        [/filter]
        [message]
            speaker=Ravyan
            message= _ "I have failed in my duty..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Dvalin
        [/filter]
        [message]
            speaker=Dvalin
            message= _ "Aaargh! Curse these lizards..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
